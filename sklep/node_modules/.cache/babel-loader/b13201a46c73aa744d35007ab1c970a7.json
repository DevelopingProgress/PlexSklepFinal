{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"C:/Users/kacpi/OneDrive/Pulpit/PlexSklepFinal/PlexSklepFinal/sklep/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/kacpi/OneDrive/Pulpit/PlexSklepFinal/PlexSklepFinal/sklep/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/kacpi/OneDrive/Pulpit/PlexSklepFinal/PlexSklepFinal/sklep/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{useDispatch,useSelector}from\"react-redux\";import{Link}from\"react-router-dom\";import{useEffect}from\"react\";import LoadingBox from\"../components/LoadingBox\";import MessageBox from\"../components/MessageBox\";import{deliverOrder,detailsOrder,payOrder}from\"../actions/orderActions\";import LoadingBoxWhite from\"../components/LoadingBoxWhite\";import{SecondaryNavbar}from\"../components/Navbar/secondaryNavbar\";import{useState}from\"react\";import axios from\"axios\";import{PayPalButton}from\"react-paypal-button-v2\";import{ORDER_DELIVER_RESET,ORDER_PAY_RESET}from\"../constants/orderConstants\";export default function OrderPage(props){var orderId=props.match.params.id;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),sdkReady=_useState2[0],setSdkReady=_useState2[1];var orderDetails=useSelector(function(state){return state.orderDetails;});var order=orderDetails.order,loading=orderDetails.loading,error=orderDetails.error;var orderPay=useSelector(function(state){return state.orderPay;});var loadingPay=orderPay.loading,errorPay=orderPay.error,successPay=orderPay.success;var orderDeliver=useSelector(function(state){return state.orderDeliver;});var loadingDeliver=orderDeliver.loading,errorDeliver=orderDeliver.error,successDeliver=orderDeliver.success;var userSignin=useSelector(function(state){return state.userSignin;});var userInfo=userSignin.userInfo;var dispatch=useDispatch();useEffect(function(){var addPayPalScript=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,data,script;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/config/paypal');case 2:_yield$axios$get=_context.sent;data=_yield$axios$get.data;script=document.createElement('script');script.type='text/javascript';script.src=\"https://www.paypal.com/sdk/js?client-id=\".concat(data,\"&currency=PLN\");script.async=true;script.onload=function(){setSdkReady(true);};document.body.appendChild(script);case 10:case\"end\":return _context.stop();}}},_callee);}));return function addPayPalScript(){return _ref.apply(this,arguments);};}();if(!order||successPay||successDeliver||order&&order._id!==orderId){dispatch({type:ORDER_PAY_RESET});dispatch({type:ORDER_DELIVER_RESET});dispatch(detailsOrder(orderId));}else{if(!order.isPaid){if(!window.paypal){addPayPalScript();}else{setSdkReady(true);}}}},[dispatch,orderId,sdkReady,successPay,order,successDeliver]);var successPaymentHandler=function successPaymentHandler(paymentResult){dispatch(payOrder(order,paymentResult));};var deliverHandler=function deliverHandler(){dispatch(deliverOrder(order._id));};return loading?/*#__PURE__*/_jsx(LoadingBoxWhite,{}):error?/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:error}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(SecondaryNavbar,{}),/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row top\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-2\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"card card-body\",children:[/*#__PURE__*/_jsxs(\"h1\",{style:{marginBottom:'10px',color:'black'},children:[\"Numer Zam\\xF3wienia: \",order._id]}),/*#__PURE__*/_jsx(\"h2\",{children:\"Dostawa\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Imi\\u0119 i Nazwisko: \"}),\" \",order.shippingAddress.name,\" \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:\"Adres Wysy\\u0142ki: \"}),\" \",order.shippingAddress.address,\", \\xA0\",order.shippingAddress.city,\", \\xA0\",order.shippingAddress.postalCode,\", \\xA0\",order.shippingAddress.country]}),order.isDelivered?/*#__PURE__*/_jsxs(MessageBox,{variant:\"success\",children:[\"Dostarczono: \",order.deliveredAt]}):/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:\"Zam\\xF3wienie Niedostarczone\"})]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"card card-body\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Metoda P\\u0142atno\\u015Bci\"}),/*#__PURE__*/_jsxs(\"p\",{children:[order.paymentMethod,\" \",/*#__PURE__*/_jsx(\"br\",{})]}),order.isPaid?/*#__PURE__*/_jsxs(MessageBox,{variant:\"success\",children:[\"Zap\\u0142acono: \",order.paidAt]}):/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:\"Zam\\xF3wienie Nieop\\u0142acone\"})]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"card card-body\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Zam\\xF3wienie\"}),/*#__PURE__*/_jsx(\"ul\",{children:order.orderItems.map(function(item){return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row  borderwhite\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Link,{to:\"/product/\".concat(item.product),children:[\" \",/*#__PURE__*/_jsx(\"img\",{className:\"small hoverbig\",src:process.env.PUBLIC_URL+item.image,alt:item.name})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"min-30\",children:/*#__PURE__*/_jsx(\"h2\",{children:/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item.product),className:\"hoverred blacked\",children:item.name})})}),/*#__PURE__*/_jsx(\"div\",{className:\"blacked\",children:/*#__PURE__*/_jsxs(\"p\",{children:[item.qty,\" x \",item.price,\" z\\u0142 = \",item.qty*item.price,\" z\\u0142\"]})})]})},item.product);})})]})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-1\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card card-body\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"h2\",{children:\"Podsumowanie Zam\\xF3wienia\"})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"Suma\"}),/*#__PURE__*/_jsxs(\"div\",{children:[order.itemsPrice.toFixed(2),\" z\\u0142\"]})]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"Koszt Dostawy\"}),/*#__PURE__*/_jsxs(\"div\",{children:[order.shippingPrice.toFixed(2),\" z\\u0142\"]})]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"VAT\"}),/*#__PURE__*/_jsxs(\"div\",{children:[order.taxPrice.toFixed(2),\" z\\u0142\"]})]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Razem\"})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"strong\",{children:[\" \",order.totalPrice.toFixed(2),\" z\\u0142\"]})})]})}),!order.isPaid&&/*#__PURE__*/_jsx(\"li\",{children:!sdkReady?/*#__PURE__*/_jsx(LoadingBox,{}):/*#__PURE__*/_jsxs(\"div\",{children:[errorPay&&/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:errorPay}),loadingPay&&/*#__PURE__*/_jsx(LoadingBox,{}),/*#__PURE__*/_jsx(PayPalButton,{amount:order.totalPrice,onSuccess:successPaymentHandler,currency:\"PLN\"})]})}),userInfo.isAdmin&&order.isPaid&&!order.isDelivered&&/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"primary block whitened hoverblack\",onClick:deliverHandler,children:\"Dostarcz Zam\\xF3wienie\"})})]})})})]})})]});}","map":{"version":3,"sources":["C:/Users/kacpi/OneDrive/Pulpit/PlexSklepFinal/PlexSklepFinal/sklep/src/pages/order.js"],"names":["React","useDispatch","useSelector","Link","useEffect","LoadingBox","MessageBox","deliverOrder","detailsOrder","payOrder","LoadingBoxWhite","SecondaryNavbar","useState","axios","PayPalButton","ORDER_DELIVER_RESET","ORDER_PAY_RESET","OrderPage","props","orderId","match","params","id","sdkReady","setSdkReady","orderDetails","state","order","loading","error","orderPay","loadingPay","errorPay","successPay","success","orderDeliver","loadingDeliver","errorDeliver","successDeliver","userSignin","userInfo","dispatch","addPayPalScript","get","data","script","document","createElement","type","src","async","onload","body","appendChild","_id","isPaid","window","paypal","successPaymentHandler","paymentResult","deliverHandler","marginBottom","color","shippingAddress","name","address","city","postalCode","country","isDelivered","deliveredAt","paymentMethod","paidAt","orderItems","map","item","product","process","env","PUBLIC_URL","image","qty","price","itemsPrice","toFixed","shippingPrice","taxPrice","totalPrice","isAdmin"],"mappings":"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","sourcesContent":["import React from 'react'\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport {Link} from \"react-router-dom\";\r\nimport {useEffect} from \"react\";\r\nimport LoadingBox from \"../components/LoadingBox\";\r\nimport MessageBox from \"../components/MessageBox\";\r\nimport {deliverOrder, detailsOrder, payOrder} from \"../actions/orderActions\";\r\nimport LoadingBoxWhite from \"../components/LoadingBoxWhite\";\r\nimport {SecondaryNavbar} from \"../components/Navbar/secondaryNavbar\";\r\nimport {useState} from \"react\";\r\nimport axios from \"axios\";\r\nimport {PayPalButton} from \"react-paypal-button-v2\";\r\nimport {ORDER_DELIVER_RESET, ORDER_PAY_RESET} from \"../constants/orderConstants\";\r\n\r\nexport default function OrderPage (props) {\r\n\r\n    const orderId = props.match.params.id;\r\n    const [sdkReady, setSdkReady] = useState(false);\r\n    const orderDetails = useSelector((state) => state.orderDetails);\r\n    const { order, loading, error } = orderDetails;\r\n    const orderPay = useSelector((state) => state.orderPay);\r\n    const { loading: loadingPay, error: errorPay, success: successPay,} = orderPay;\r\n    const orderDeliver = useSelector((state) => state.orderDeliver);\r\n    const { loading: loadingDeliver, error: errorDeliver, success: successDeliver,} = orderDeliver;\r\n    const userSignin = useSelector((state) => state.userSignin);\r\n    const {userInfo} = userSignin;\r\n    const dispatch = useDispatch();\r\n\r\n\r\n    useEffect(() => {\r\n        const addPayPalScript = async () => {\r\n                const { data } = await axios.get('/api/config/paypal');\r\n                const script = document.createElement('script');\r\n                script.type = 'text/javascript';\r\n                script.src = `https://www.paypal.com/sdk/js?client-id=${data}&currency=PLN`;\r\n                script.async = true;\r\n                script.onload = () => {\r\n                    setSdkReady(true);\r\n                };\r\n                document.body.appendChild(script);\r\n        };\r\n        if (!order || successPay || successDeliver || (order && order._id !== orderId)) {\r\n            dispatch({type:ORDER_PAY_RESET});\r\n            dispatch({type:ORDER_DELIVER_RESET});\r\n            dispatch(detailsOrder(orderId));\r\n        } else {\r\n            if (!order.isPaid) {\r\n                if (!window.paypal) {\r\n                    addPayPalScript();\r\n                } else {\r\n                    setSdkReady(true);\r\n                }\r\n            }\r\n        }\r\n    }, [dispatch, orderId, sdkReady, successPay, order, successDeliver]);\r\n\r\n    const successPaymentHandler = (paymentResult) => {\r\n        dispatch(payOrder(order, paymentResult));\r\n    }\r\n\r\n\r\n    const deliverHandler = () => {\r\n        dispatch(deliverOrder(order._id));\r\n    }\r\n\r\n    return loading ? (<LoadingBoxWhite/>) : error ? (<MessageBox variant=\"danger\">{error}</MessageBox>) : (\r\n        <div>\r\n            <SecondaryNavbar/>\r\n            <div className=\"container\">\r\n                <div className=\"row top\">\r\n                    <div className=\"col-2\">\r\n                        <ul>\r\n                            <li>\r\n                                <div className=\"card card-body\">\r\n                                    <h1 style={{marginBottom: '10px', color: 'black'}}>Numer Zamówienia: {order._id}</h1>\r\n                                    <h2>Dostawa</h2>\r\n                                    <p>\r\n                                        <strong>Imię i Nazwisko: </strong> {order.shippingAddress.name} <br/>\r\n                                        <strong>Adres Wysyłki: </strong> {order.shippingAddress.address}, &nbsp;\r\n                                        {order.shippingAddress.city}, &nbsp;\r\n                                        {order.shippingAddress.postalCode}, &nbsp;\r\n                                        {order.shippingAddress.country}\r\n                                    </p>\r\n\r\n                                    {order.isDelivered ? <MessageBox variant=\"success\">Dostarczono: {order.deliveredAt}</MessageBox>: <MessageBox variant=\"danger\">Zamówienie Niedostarczone</MessageBox>}\r\n                                </div>\r\n                            </li>\r\n                            <li>\r\n                                <div className=\"card card-body\">\r\n                                    <h2>Metoda Płatności</h2>\r\n                                    <p>\r\n                                        {order.paymentMethod} <br/>\r\n                                    </p>\r\n                                    {order.isPaid ? <MessageBox variant=\"success\">Zapłacono: {order.paidAt}</MessageBox>: <MessageBox variant=\"danger\">Zamówienie Nieopłacone</MessageBox>}\r\n                                </div>\r\n                            </li>\r\n                            <li>\r\n                                <div className=\"card card-body\">\r\n                                    <h2>Zamówienie</h2>\r\n                                    <ul>\r\n                                        {order.orderItems.map((item) => (\r\n                                            <li key={item.product}>\r\n                                                <div className=\"row  borderwhite\">\r\n                                                    <div>\r\n                                                        <Link to={`/product/${item.product}`}> <img\r\n                                                            className=\"small hoverbig\"\r\n                                                            src={process.env.PUBLIC_URL + item.image}\r\n                                                            alt={item.name}\r\n                                                        /></Link>\r\n                                                    </div>\r\n                                                    <div className=\"min-30\">\r\n                                                        <h2><Link to={`/product/${item.product}`} className=\"hoverred blacked\" >{item.name}</Link></h2>\r\n                                                    </div>\r\n                                                    <div className=\"blacked\"><p>{item.qty} x {item.price} zł = {item.qty * item.price} zł</p></div>\r\n                                                </div>\r\n                                            </li>\r\n                                        ))}\r\n                                    </ul>\r\n                                </div>\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n                    <div className=\"col-1\">\r\n                        <div className=\"card card-body\">\r\n                            <ul>\r\n                                <li>\r\n                                    <h2>Podsumowanie Zamówienia</h2>\r\n                                </li>\r\n                                <li>\r\n                                        <div className=\"row\">\r\n                                            <div>Suma</div>\r\n                                            <div>{order.itemsPrice.toFixed(2)} zł</div>\r\n                                        </div>\r\n                                </li>\r\n                                <li>\r\n                                    <div className=\"row\">\r\n                                        <div>Koszt Dostawy</div>\r\n                                        <div>{order.shippingPrice.toFixed(2)} zł</div>\r\n                                    </div>\r\n                                </li>\r\n                                <li>\r\n                                    <div className=\"row\">\r\n                                        <div>VAT</div>\r\n                                        <div>{order.taxPrice.toFixed(2)} zł</div>\r\n                                    </div>\r\n                                </li>\r\n                                <li>\r\n                                    <div className=\"row\">\r\n                                        <div><strong>Razem</strong></div>\r\n                                        <div><strong> {order.totalPrice.toFixed(2)} zł</strong></div>\r\n                                    </div>\r\n                                </li>\r\n                                {!order.isPaid && (\r\n                                    <li>\r\n                                        {!sdkReady ? (\r\n                                            <LoadingBox/>\r\n                                        ) : (\r\n                                            <div>\r\n                                                {errorPay && (\r\n                                                    <MessageBox variant=\"danger\">{errorPay}</MessageBox>\r\n                                                )}\r\n                                                {loadingPay && <LoadingBox/>}\r\n\r\n                                                <PayPalButton amount={order.totalPrice} onSuccess={successPaymentHandler} currency=\"PLN\"/>\r\n                                            </div>\r\n                                        )}\r\n                                    </li>\r\n                                )}\r\n                                {userInfo.isAdmin && order.isPaid && !order.isDelivered && (\r\n                                    <li>\r\n                                        <button type=\"button\" className=\"primary block whitened hoverblack\" onClick={deliverHandler}>Dostarcz Zamówienie</button>\r\n                                    </li>\r\n                                )}\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n    )\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}